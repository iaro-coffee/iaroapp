{% extends "base_generic.html" %}

{% block content %}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom"
     xmlns:task.done_datetime xmlns:task.done_datetime xmlns:task.done_datetime xmlns:task.done_datetime>
    <h1 class="h2">Tasks Overview</h1>
</div>

<div style="width: 100%;">
    {% for weekday in weekdays%}
    <div class="list-group">
        <h4 data-bs-toggle="collapse"
            href="#collapse{{ weekday }}"
            role="button"
            class="list-group-item"
            style="margin-bottom: 0px; margin-top: 15px;">
            {{ weekday }}
        </h4>
        <div class="list-group-item collapse {% if weekday == today %}show{% endif %}" id="collapse{{ weekday }}">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th scope="col">Name</th>
                    <th scope="col" style="white-space: nowrap;">Done</th>
                </tr>
                </thead>
                <tbody>
                {% for key, tasks in tasks.items %}
                    {% if key == weekday %}
                        {% for task in tasks %}
                        <tr class="{% if weekday in task.done.keys %}done{% else %}open{% endif %}">
                            <td style="vertical-align: middle;"><label>{{ task.title }}</label></td>
                            <td style="vertical-align: middle;">
                                <label style="font-size: 12px;">
                                {% if weekday in task.done.keys %}
                                    {% for key, value in task.done.items %}
                                      {% if key == weekday %}
                                        {{ value.done_datetime }} by <b>{{ value.done_persons|join:", " }}{% endif %}</b>
                                    {% endfor %}
                                {% endif %}
                              </label>
                            </td>
                        </tr>
                        {% endfor %}
                    {% endif %}
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endfor %}
</div>

<style>
  table {
    font-size: 1rem;
  }
  label {
    width: 100%;
    padding: .9rem;
    user-select: none;
    height: 100%;
  }
  h4 {
    background-color: rgb(248, 215, 218);
  }
  .done {
    background-color: rgb(209, 231, 221);
  }
  .open {
    background-color: rgb(248, 215, 218);
    border-bottom-color: rgb(201, 192, 192) !important;
  }
  td:not(first-child) {
    padding: 0rem !important;
    overflow-wrap: anywhere;
  }
  td:first-child {
    padding: 0.8rem !important;
  }
</style>

<script type="text/javascript">
  (() => {
    document.getElementById("collapse{{ today }}").scrollIntoView({
      behavior: 'smooth'
    });

    // Colorize weekdays depending on tasks done
    const listGroupItems = document.querySelectorAll('h4.list-group-item');
    for (const [index, listGroupItem] of listGroupItems.entries()) {
      const collapseElement = listGroupItem.nextElementSibling;
      const areAllSubTrsDone = Array.from(collapseElement.querySelectorAll('tbody tr')).every((trElement) => {
        return trElement.classList.contains('done');
      });
      listGroupItem.classList.add(areAllSubTrsDone ? 'done' : 'open');
      if (index > 0) {
        listGroupItem.classList.add('not-first');
      }
    }
    const firstListGroupItem = listGroupItems[0];
    firstListGroupItem.classList.remove('not-first');

  })()
</script>

{% endblock %}